<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#1e1e1e">
<title>CashCubby</title>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCsm-C2VKGG5iSou78uhWa06ziRNoo7snY",
    authDomain: "cashcubby-4fd56.firebaseapp.com",
    projectId: "cashcubby-4fd56",
    storageBucket: "cashcubby-4fd56.appspot.com",
    messagingSenderId: "1029003579417",
    appId: "1:1029003579417:web:8cb6f76741ce7b663ada88"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
</script>

<style>
:root {
  --bg: #1e1e1e;
  --fg: #f0f0f0;
  --card: #2c2c2c;
  --accent: #ff4d4f;
  --accent2: #52c41a;
  --muted: #555;
  --danger: #ff4d4f;
}
[data-theme="light"] {
  --bg: #f5f5f5;
  --fg: #1e1e1e;
  --card: #ffffff;
  --accent: #ff4d4f;
  --accent2: #52c41a;
  --muted: #aaa;
  --danger: #ff4d4f;
}

body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  min-height: 100vh;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 20px;
  transition: background 0.3s, color 0.3s;
}

.container {
  width: 100%;
  max-width: 420px;
  background: var(--card);
  border-radius: 20px;
  padding: 24px;
  box-shadow: 0 6px 14px rgba(0,0,0,0.15);
}

h1 { text-align:center; margin:0 0 10px; font-size:28px; }

.balance {
  text-align:center;
  font-weight:700;
  font-size:22px;
  margin:8px 0 14px;
  color: var(--accent2);
  transition:color 0.25s ease;
}
.balance.is-debt { color: var(--accent); }

label { display:block; margin-top:10px; font-weight:600; }

input[type="number"], input[type="text"] {
  width:100%;
  box-sizing: border-box;
  margin-top:6px;
  padding:10px 12px;
  border:1px solid var(--muted);
  border-radius:10px;
  background:var(--bg);
  color:var(--fg);
  outline:none;
}

.buttons { display:flex; gap:4%; margin-top:14px; flex-wrap:wrap; }
button.action {
  flex:1 1 48%;
  padding:10px 12px;
  border:none;
  border-radius:12px;
  font-size:16px;
  cursor:pointer;
  margin-bottom:6px;
}
.add { background:var(--accent2); color:#000; }
.withdraw { background:var(--accent); color:#fff; }
.undo { background:var(--danger); color:#fff; }
.reset { background:#555; color:#fff; }

ul#history {
  list-style:none;
  margin:18px 0 0;
  padding:0;
  max-height:150px;
  overflow-y:auto;
}
ul#history li {
  background:var(--bg);
  border:1px solid var(--muted);
  border-radius:8px;
  padding:8px 10px;
  font-size:14px;
  margin-bottom:6px;
}

.theme-switch {
  position:fixed;
  top:10px;
  right:10px;
  padding:3px 6px;
  font-size:12px;
  border-radius:6px;
  border:none;
  background:var(--accent2);
  cursor:pointer;
}

.cloud { margin-top:20px; padding:10px; border-radius:10px; background:var(--bg); border:1px solid var(--muted); }
.cloud button {
  width:100%;
  margin-top:6px;
  padding:10px;
  font-size:14px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  background: var(--accent2);
}
.cloud input {
  width:100%;
  box-sizing:border-box;
  margin-top:6px;
  padding:10px;
  border:1px solid var(--muted);
  border-radius:10px;
  background: var(--bg);
  color: var(--fg);
  outline:none;
}
.cloud .status { font-size:14px; margin-top:6px; text-align:center; }

@media (max-width:480px) {
  .container { padding:16px; border-radius:16px; }
  h1 { font-size:24px; }
  .balance { font-size:20px; }
  input, .cloud input { font-size:14px; padding:8px 10px; }
  .buttons button { font-size:14px; padding:8px 10px; }
  .cloud button { font-size:14px; padding:6px 8px; }
}
</style>
</head>
<body data-theme="dark">
<div class="container">
  <h1>CashCubby</h1>
  <div class="balance" id="balance">$0.00</div>
  <label>Amount</label>
  <input type="number" id="amount" placeholder="Enter amount">

  <div class="buttons">
    <button class="action add">Deposit</button>
    <button class="action withdraw">Withdraw</button>
    <button class="action undo">Undo</button>
    <button class="action reset">Reset</button>
  </div>

  <ul id="history"></ul>

  <div class="cloud">
    <label>Save Balance (Cloud)</label>
    <button id="saveBtn">Save</button>
    <div class="status" id="saveStatus"></div>
  </div>

  <div class="cloud">
    <label>Load Balance with Code</label>
    <input type="text" id="loadCode" placeholder="Enter code">
    <button id="loadBtn">Load</button>
    <div class="status" id="loadStatus"></div>
  </div>
</div>

<button class="theme-switch" id="themeSwitch">Switch Theme</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCsm-C2VKGG5iSou78uhWa06ziRNoo7snY",
    authDomain: "cashcubby-4fd56.firebaseapp.com",
    projectId: "cashcubby-4fd56",
    storageBucket: "cashcubby-4fd56.appspot.com",
    messagingSenderId: "1029003579417",
    appId: "1:1029003579417:web:8cb6f76741ce7b663ada88"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const balanceEl = document.getElementById("balance");
  const amountEl = document.getElementById("amount");
  const historyEl = document.getElementById("history");
  const saveBtn = document.getElementById("saveBtn");
  const loadBtn = document.getElementById("loadBtn");
  const loadCodeEl = document.getElementById("loadCode");
  const saveStatusEl = document.getElementById("saveStatus");
  const loadStatusEl = document.getElementById("loadStatus");
  const themeSwitch = document.getElementById("themeSwitch");

  let balance = 0;
  let history = [];

  function updateDisplay() {
    balanceEl.textContent = `$${balance.toFixed(2)}`;
    balanceEl.classList.toggle("is-debt", balance<0);
    historyEl.innerHTML = "";
    history.forEach(item=>{
      const li = document.createElement("li");
      li.textContent = item;
      historyEl.appendChild(li);
    });
  }

  function pushHistory(action, amt) {
    history.unshift(`${action}: $${amt.toFixed(2)}`);
    if(history.length>20) history.pop();
  }

  document.querySelector(".add").addEventListener("click", ()=>{
    const amt = parseFloat(amountEl.value);
    if(!isNaN(amt)) {
      balance += amt;
      pushHistory("Deposit", amt);
      updateDisplay();
      amountEl.value="";
    }
  });

  document.querySelector(".withdraw").addEventListener("click", ()=>{
    const amt = parseFloat(amountEl.value);
    if(!isNaN(amt)) {
      balance -= amt;
      pushHistory("Withdraw", amt);
      updateDisplay();
      amountEl.value="";
    }
  });

  document.querySelector(".undo").addEventListener("click", ()=>{
    if(history.length>0){
      const last = history.shift();
      const [action, val] = last.split(": $");
      const amt = parseFloat(val);
      if(action==="Deposit") balance-=amt;
      else balance+=amt;
      updateDisplay();
    }
  });

  document.querySelector(".reset").addEventListener("click", ()=>{
    balance = 0;
    history = [];
    updateDisplay();
  });

  themeSwitch.addEventListener("click", ()=>{
    const current = document.body.getAttribute("data-theme");
    document.body.setAttribute("data-theme", current==="dark"?"light":"dark");
  });

  function randomCode() {
    return Math.random().toString(36).substring(2,10).toUpperCase();
  }

  saveBtn.addEventListener("click", async ()=>{
    const code = randomCode();
    await setDoc(doc(db, "balances", code), { balance });
    saveStatusEl.textContent = `Balance saved! Your code: ${code}`;
    setTimeout(()=>saveStatusEl.textContent="",5000);
  });

  loadBtn.addEventListener("click", async ()=>{
    const code = loadCodeEl.value.trim();
    if(!code) return;
    const docSnap = await getDoc(doc(db,"balances",code));
    if(docSnap.exists()){
      balance = docSnap.data().balance;
      updateDisplay();
      loadStatusEl.textContent = `Balance loaded! $${balance.toFixed(2)}`;
    } else loadStatusEl.textContent = "Code not found!";
    setTimeout(()=>loadStatusEl.textContent="",5000);
  });

  updateDisplay();
</script>
</body>
</html>
